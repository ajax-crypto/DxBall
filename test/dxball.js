function getOffset(e){var t=0;var n=0;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){t+=e.offsetLeft-e.scrollLeft;n+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{top:n,left:t}}function roundRect(e,t,n,r,i,s){if(typeof i==="undefined"){i=5}ctx.beginPath();ctx.moveTo(e+i,t);ctx.lineTo(e+n-i,t);ctx.quadraticCurveTo(e+n,t,e+n,t+i);ctx.lineTo(e+n,t+r-i);ctx.quadraticCurveTo(e+n,t+r,e+n-i,t+r);ctx.lineTo(e+i,t+r);ctx.quadraticCurveTo(e,t+r,e,t+r-i);ctx.lineTo(e,t+i);ctx.quadraticCurveTo(e,t,e+i,t);ctx.closePath();if(s)ctx.fill();else ctx.stroke()}function circle(e,t,n){ctx.beginPath();ctx.arc(e,t,n,0,Math.PI*2,true);ctx.closePath();ctx.fill()}function rect(e,t,n,r){ctx.beginPath();ctx.rect(e,t,n,r);ctx.closePath();ctx.fill()}function clear(){ctx.clearRect(0,0,WIDTH,HEIGHT);rect(0,0,WIDTH,HEIGHT)}function image(e,t,n,r,i,s,o){ctx.drawImage(e,t,n,e.width,e.height,r,i,s,o)}function checkBounds(e){if(e.x<402&&e.x>250&&e.y<480&&e.y>417)return true;return false}function unregisterEvents(e){switch(e){case RUNNING:canvas.removeEventListener("keydown",runningGameSceneHandler,false);canvas.removeEventListener("keyup",runningGameSceneHandler,false);canvas.removeEventListener("mousemove",runningGameSceneHandler,false);break;case SPLASH_SCREEN:canvas.removeEventListener("click",splashScreenHandler,false);canvas.removeEventListener("mousemove",splashScreenHandler,false);break}}function handleGameEvents(e,t){unregisterEvents(t);switch(e){case START:case SPLASH_SCREEN:canvas.addEventListener("click",splashScreenHandler,false);canvas.addEventListener("mousemove",splashScreenHandler,false);break;case RUNNING:canvas.addEventListener("keydown",runningGameSceneHandler,false);canvas.addEventListener("keyup",runningGameSceneHandler,false);canvas.addEventListener("mousemove",runningGameSceneHandler,false);break}}function drawGameRunningScene(){ctx.fillStyle=Colors.BLACK;clear();ball.draw();paddle.draw();drawbricks()}function drawGameOverScene(){clear();ctx.fillStyle="#FF0000";rect(0,0,WIDTH,HEIGHT);ctx.fillStyle="#FFFAF0";ctx.font="20px Verdana";ctx.fillText("GAME OVER",WIDTH/2-50,HEIGHT/2);ctx.fillText("You have scored "+points,WIDTH/2-100,HEIGHT/2+30)}function drawLevelCompleteScene(){clear();ctx.fillStyle="#FF0000";rect(0,0,WIDTH,HEIGHT);ctx.fillStyle="#FFFAF0";ctx.font="20px Verdana";ctx.fillText("LEVEL COMPLETE",WIDTH/2-80,HEIGHT/2);ctx.fillStyle="#8B0000";rect(350,400,WIDTH-350,HEIGHT-400);ctx.fillStyle=Colors.WHITE;ctx.fillText("NEXT >>",350+(WIDTH-350)/2-40,400+(HEIGHT-400)/2);ctx.fillText("You have scored "+points,WIDTH/2-100,HEIGHT/2+30)}function drawCreditScene(){credit_image=new Image;credit_image.onload=function(){ctx.drawImage(credit_image,0,0)};credit_image.src=CREDIT_SCREEN_PATH}function drawSplashScreen(){splash_image=new Image;splash_image.onload=function(){ctx.drawImage(splash_image,0,0)};splash_image.src=SPLASH_SCREEN_PATH}function drawGameScenes(e){switch(e){case START:case SPLASH_SCREEN:drawSplashScreen();break;case RUNNING:drawGameRunningScene();break;case CREDIT_SCENE:drawCreditScene();break;case GAME_OVER:drawGameOverScene();break}}function Paddle(e,t,n,r,i){this.x=e;this.height=t;this.width=n;this.color=r;this.speed=i;this.ticks=0;this.image=new Image;this.image.src=PADDLE_IMAGE_PATH;this.draw=function(){ctx.fillStyle=this.color;image(this.image,0,0,this.x,HEIGHT-this.height,this.width,this.height)};this.shorten=function(){this.ticks=3;if(this.width>25&&this.ticks>0)this.width-=10;if(this.ticks==0)this.width+=10};this.elongate=function(){this.ticks=3;if(this.width<125&&this.ticks>0)this.width+=10;if(this.ticks==0)this.width-=10}}function Brick(e,t,n,r,i,s){this.width=e;this.height=t;this.padding=n;this.points=r;this.color=i;this.speedup=false;this.visible=s;this.destructible=1;this.destroyed=false;this.paddleElongate=0;switch(this.color){case"#FF1C0A":this.destructible=0;break;case"#00A308":this.points+=100;break;case"#EB0093":this.paddleElongate=1;break;case"#8A2BE2":this.paddleElongate=-1;break;case"#A0522D":this.destructible=~~(Math.random()*2)+1;break;case"#7FFFD4":this.speedup=true;break}this.draw=function(e,t){if(!this.visible)this.destroyed=true;if(this.visible){ctx.fillStyle=this.color;rect(t*(this.width+this.padding)+this.padding,e*(this.height+this.padding)+this.padding,this.width,this.height)}}}function initBricks(){bricks=new Array(NROWS);for(i=0;i<NROWS;i++){bricks[i]=new Array(NCOLS);for(j=0;j<NCOLS;j++){bricks[i][j]=new Brick(BrickDefaults.WIDTH,BrickDefaults.HEIGHT,BrickDefaults.PADDING,~~(Math.random()*10),rowcolors[~~(Math.random()*10)],levels[GAME_LEVEL][i][j])}}}function drawbricks(){for(i=0;i<NROWS;i++)for(j=0;j<NCOLS;j++)bricks[i][j].draw(i,j)}function Ball(e,t,n,r,i,s){this.x=e;this.y=t;this.radius=n;this.dx=r;this.dy=i;this.color=s;this.ticks=0;this.draw=function(){ctx.fillStyle=this.color;circle(this.x,this.y,this.radius)};this.speedup=function(){if(this.dy<0)this.dy-=BallDefaults.SPEED_UP;else this.dy+=BallDefaults.SPEED_UP};this.normalSpeed=function(){if(this.dy<0)this.dy=-BallDefaults.SPEED;else this.dy=BallDefaults.SPEED};this.minDistanceX=function(){return this.dx>0?this.x+this.radius:this.x-this.radius};this.minDistanceY=function(){return this.dy>0?this.y+this.radius:this.y>=0?this.y:this.y-this.radius}}function initBall(){ball.x=BallDefaults.X;ball.y=BallDefaults.Y;ball.dx=BallDefaults.DX;ball.dy=BallDefaults.DY}function handlePaddle(){if(rightDown&&paddle.x<canvasMaxX)paddle.x+=paddle.speed;else if(leftDown&&paddle.x>canvasMinX)paddle.x-=paddle.speed}function handleBallBrick(){if(ball.y<NROWS*BrickDefaults.TRUE_HEIGHT){var e=~~(ball.y/BrickDefaults.TRUE_HEIGHT);var t=~~(ball.x/BrickDefaults.TRUE_WIDTH);if(e>=0&&t>=0&&bricks[e][t].visible){if(ball.x>t*BrickDefaults.HEIGHT&&ball.x<(t+1)*BrickDefaults.HEIGHT)ball.dx=-ball.dx;else ball.dy=-ball.dy;if(bricks[e][t].speedup)ball.speedup();else ball.normalSpeed();if(bricks[e][t].destructible==1){bricks[e][t].visible=false;bricks[e][t].destroyed=true;if(bricks[e][t].paddleElongate>0)paddle.elongate();else if(bricks[e][t].paddleElongate<0)paddle.shorten()}else if(bricks[e][t].destructible>1)bricks[e][t].destructible--;points+=bricks[e][t].points}}}function handleBallPaddle(){var e=ball.x+ball.dx+ball.radius;var t=ball.x+ball.dx-ball.radius;var n=ball.y+ball.dy;if(e>WIDTH||t<0)ball.dx=-ball.dx;if(n<0)ball.dy=-ball.dy;else if(n>HEIGHT-paddle.height){if(ball.x>paddle.x&&ball.x<paddle.x+paddle.width){ball.dx=8*((ball.x-(paddle.x+paddle.width/2))/paddle.width);ball.dy=-ball.dy;if(paddle.ticks>0)paddle.ticks--}else if(n>HEIGHT){return false}}return true}function handleCollisions(){handlePaddle();handleBallBrick();var e=handleBallPaddle();ball.x+=ball.dx;ball.y+=ball.dy;return e}function isComplete(){for(i=0;i<NROWS;i++)for(j=0;j<NCOLS;j++)if(levels[GAME_LEVEL][i][j].destroyed==false&&levels[GAME_LEVEL][i][j].destructible>0)return false;return true}function gameLoop(){var e;if(prevState!=gameState){handleGameEvents(gameState,prevState)}if(prevState!=gameState||gameState==RUNNING)e=true;prevState=gameState;if(e)drawGameScenes(gameState);if(playState)playState=handleCollisions();else if(!playState){console.log("Game over");gameState=GAME_OVER}else if(isComplete()){gameState=LEVEL_COMPLETE;++GAME_LEVEL}if(gameState!=PAUSED)loop=setTimeout(gameLoop,1e3/FPS)}function restartGame(){gameState=RUNNING;clearTimeout(loop);startGame()}function startGame(){initBricks();initBall();playState=true;gameLoop()}function resumeGame(){gameState=RUNNING;gameLoop()}var canvas=document.getElementById("dxball");var ctx=canvas.getContext("2d");var WIDTH=640;var HEIGHT=480;var rightDown=false;var leftDown=false;var bricks;var loop;var points=1;var PADDLE_IMAGE_PATH="img/paddle.png";var SPLASH_SCREEN_PATH="img/splash.png";CREDIT_SCREEN_PATH="img/credit.png";var Colors=Object.freeze({WHITE:"#FFFFFF",BLACK:"#000000"});var BrickDefaults=Object.freeze({WIDTH:80,HEIGHT:25,PADDING:1,TRUE_HEIGHT:26,TRUE_WIDTH:81});var PaddleDefaults=Object.freeze({WIDTH:75,HEIGHT:10,SPEED:7,COLOR:Colors.WHITE,XPOS:WIDTH/2});var BallDefaults=Object.freeze({RADIUS:6,COLOR:Colors.WHITE,SPEED:4,DX:1.5,DY:-4,X:25,Y:250,SPEED_UP:4});var rowcolors=["#FF1C0A","#FFFD0A","#00A308","#0008DB","#EB0093","#7FFFD4","#8A2BE2","#A0522D"];var GAME_LEVEL=0;var FPS=100;var AUTHOR="Akash Pradhan";var START=-1;var SPLASH_SCREEN=0;var RUNNING=1;var LEVEL_COMPLETE=2;var GAME_OVER=3;var PAUSED=4;var CREDIT_SCENE=5;var gameState=START;var prevState=-2;var playState=true;var canvasMinX=getOffset(canvas).left;var canvasMaxX=canvasMinX+WIDTH;var canvasMinY=getOffset(canvas).top;document.getElementById("start").addEventListener("click",function(){pause.innerHTML="Pause";restartGame()},false);document.getElementById("pause").addEventListener("click",function(){if(gameState==RUNNING){gameState=PAUSED;pause.innerHTML="Resume"}else if(gameState==PAUSED){resumeGame();pause.innerHTML="Pause"}},false);var runningGameSceneHandler={handleEvent:function(e){switch(e.type){case"keydown":if(e.keyCode==39)rightDown=false;else if(e.keyCode==37)leftDown=false;break;case"keyup":if(e.keyCode==39)rightDown=true;else if(e.keyCode==37)leftDown=true;break;case"mousemove":if(e.pageX>canvasMinX&&e.pageX<canvasMaxX){paddle.x=Math.max(e.pageX-canvasMinX-paddle.width/2,0);paddle.x=Math.min(WIDTH-paddle.width,paddle.x)}break}}};var splashScreenHandler={handleEvent:function(e){switch(e.type){case"click":e.preventDefault();var t={x:e.pageX-canvasMinX,y:e.pageY-canvasMinY};if(checkBounds(t)){clear();gameState=CREDIT_SCENE}break;case"mousemove":var t={x:e.pageX-canvasMinX,y:e.pageY-canvasMinY};if(checkBounds(t))canvas.style.cursor="pointer";else canvas.style.cursor="default";break}}};var NROWS=8;var NCOLS=8;var MAX_LEVELS=10;var levels=new Array(MAX_LEVELS);var brickMatrix=new Array(NROWS);for(var i=0;i<NROWS-1;++i)brickMatrix[i]=[false,false,false,false,false,false,false,false];brickMatrix[NROWS-1]=[false,true,true,true,true,true,true,true];levels[0]=brickMatrix;var paddle=new Paddle(PaddleDefaults.XPOS,PaddleDefaults.HEIGHT,PaddleDefaults.WIDTH,PaddleDefaults.COLOR,PaddleDefaults.SPEED);var ball=new Ball(BallDefaults.X,BallDefaults.Y,BallDefaults.RADIUS,BallDefaults.DX,BallDefaults.DY,BallDefaults.COLOR)